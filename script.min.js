const mycreate=document.querySelector("#mycreate"),walletMenu=document.querySelector("#walletMenu"),firebaseConfig={apiKey:"AIzaSyBaPvnzqor_4HfPZg6ayk30Tb1RpcMBWfo",authDomain:"test-66b58.firebaseapp.com",projectId:"test-66b58",storageBucket:"test-66b58.appspot.com",messagingSenderId:"39985206495",appId:"1:39985206495:web:c4200c42a6e7bad4da456a",measurementId:"G-G1RBDR6H1S"};firebase.initializeApp(firebaseConfig);const db=firebase.firestore(),storage=firebase.storage();var ImgName,ImgUrl,files=[],reader=new FileReader;let url=location.href,paramaters=new URL(url).searchParams,o=paramaters.get("o");"signup"==o?changeO("signup"):"login"==o&&changeO("login");var batch=db.batch();let idget=null;const dbRef=firebase.database().ref();firebase.database().ref("id/id").get().then((e=>{e.exists()?idget=e.val():alert("No Internet Connection")})).catch((e=>{console.error(e)}));let uif,currentPassword,userdata={};async function getUserData(e){dbRef.child("users").child(e).get().then((e=>{e.exists()?userdata=e.val():console.warn("No data available")})).catch((e=>{console.error(e)}))}function setUser(e,a,r,t,s){return uif={name:e,email:a,pImg:r,pwd:t,uid:s},uif}function SignUp(){""==usernameSignUp.value?alert("Enter your username and try again."):passwordSignUp.value==passwordSignUpAgain.value&&""!=passwordSignUp.value?""==emailSignUp.value?alert("Please enter your email and try again."):(writeUserData(++idget,usernameSignUp.value,emailSignUp.value,"img/defProfilePicture.jpg",passwordSignUp.value,idget),currentPassword=passwordSignUp.value,alert("SignUp Successful"),alert(`Your UserId is ${idget}`),LogInAuto(),newMailBox(idget)):alert("Your passwords didn't match.")}var un,em,pi,ps,uid;function dashboard(){startDiv.style="display:none;",dashBoard.style=`display:flex;width:${window.innerWidth};`;let e=uif;un=e.name,em=e.email,pi=e.pImg,ps=e.pwd,uid=e.uid,profilePicture.src=pi,profilePicture.className="profilePicture",usernameBD.innerHTML=un,idDB.innerHTML='<label class="uds">User ID : </label>'+uid,otherUsersDiv.src=`explorer.html?gid=${uid}&gname=1`,creatorDiv.src=`create.html?gid=${uid}&gname=${un}&gtitle=1`,creatorDiv.style="height:700px;",menu.style="display:block",mycreate.setAttribute("href",`create.html?gid=${uid}&gname=${un}&gtitle=1`),walletMenu.setAttribute("href",`https://gncwallet.netlify.app?id=${uid}&password=${ps}`)}function LogOut(){location.href="?logout=true"}async function LogIn(){""==idLogIn.value?alert("Enter your user id and try again."):(getUserData(idLogIn.value),setUser(userdata.username,userdata.email,userdata.profile_picture,userdata.password,userdata.id),setTimeout(check,1e3))}async function LogInAuto(){getUserData(idget),setTimeout(check2,1e3)}function check2(){currentPassword==userdata.password?(setUser(userdata.username,userdata.email,userdata.profile_picture,userdata.password,userdata.id),setTimeout(dashboard,500)):alert("Login Error")}function check(){passwordLogIn.value==userdata.password?(setUser(userdata.username,userdata.email,userdata.profile_picture,userdata.password,userdata.id),setTimeout(dashboard,500)):alert("password didn't match.")}function writeUserData(e,a,r,t,s,i){firebase.database().ref("id").set({id:e}),firebase.database().ref("users/"+e).set({username:a,email:r,profile_picture:t,password:s,id:i,wallet:{coin:{bal:0}}})}function newMailBox(e){firebase.database().ref("mails/"+e).set({all:1,mails:{1:{body:"Our app is a social media app for gardener and farmers.",title:"Welcome to Garden Net.",user:"Garden Net"}}})}
